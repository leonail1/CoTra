# ../scripts/sift/500M_8P_scala_anns.sh

source ../scripts/restart_memcache.sh
CONF_FILE="../scripts/ip_w41-48.conf"
clear_memcache "$CONF_FILE"

dataset_path=/data/share/users/xyzhi/data/bigann
million=500
base_file=${dataset_path}/base.${million}M.u8bin
gt_file=/data/share/users/xyzhi/data/GT_all/GT_${million}M/bigann-${million}M
query_path=/data/share/users/xyzhi/data/bigann/query.public.10K.u8bin
num_threads=1
index_save_path=/data/share/users/xyzhi/data/bigann

# this scripts is curently used for 
index_save_dir=${index_save_path}/scalagraph/test_${million}M_8P
for m in 1
do
    mkdir -p ${index_save_dir}
    ./tests/scala_anns \
    --config_file ${CONF_FILE} \
    --app_type scala_v3 \
    --graph_type scalagraph_v3 \
    --data_type uint8 --dist_fn l2 \
    --data_path ${base_file} \
    --query_path ${query_path} \
    --gt_path ${gt_file} \
    --index_path_prefix ${index_save_dir}/merged_index \
    -R 48 -L 500 -B 100 -M 120 -T ${num_threads} \
    --scala_v3 -s ${million} -t ${num_threads}
done

# profiling computation efficiency origin
# 20       0.82714         0.00    9795.230        16301368
# 30       0.87552         0.00    8041.430        20887069
# 50       0.92426         0.00    5850.906        28898521
# 100      0.96762         0.00    3599.097        47252859
# 200      0.98782         0.00    2060.921        81742899
# 300      0.99339         0.00    1483.678        115394084
# 400      0.99570         0.00    1148.993        146291078
# 500      0.99699         0.00    930.262         176635489
# 600      0.99774         0.00    777.662         205911245
# 700      0.99823         0.00    668.038         234511629


# top1
# 20       0.82808         0.00    9843.140        16269854
# 30       0.87508         0.00    8064.185        20961525
# 50       0.92409         0.00    5866.094        28893979
# 100      0.96781         0.00    3582.424        47387546
# 200      0.98765         0.00    2066.578        81783097
# 300      0.99340         0.00    1483.233        115247097
# 400      0.99570         0.00    1152.317        146260938
# 500      0.99700         0.00    904.926         177390321
# 600      0.99766         0.00    792.823         205024655
# 700      0.99819         0.00    680.225         234170490

#top2
# 20       0.82916         0.00    10188.353       16249861
# 30       0.87616         0.00    8525.411        20997298
# 50       0.92453         0.00    6180.206        28780345
# 100      0.96765         0.00    3793.221        47183271
# 200      0.98755         0.00    2204.964        81147125
# 300      0.99327         0.00    1589.240        114663860
# 400      0.99562         0.00    1228.052        145965199
# 500      0.99695         0.00    1004.524        175162263
# 600      0.99762         0.00    838.745         204653942
# 700      0.99817         0.00    719.616         232124386

# top3
# 20       0.82895         0.00    10173.013       16350368
# 30       0.87705         0.00    8430.964        20928667
# 50       0.92475         0.00    6196.896        28884988
# 100      0.96773         0.00    3801.483        47126447
# 200      0.98763         0.00    2197.419        81321080
# 300      0.99334         0.00    1588.791        114153540
# 400      0.99572         0.00    1236.772        145976887
# 500      0.99692         0.00    1006.208        174830428
# 600      0.99767         0.00    845.365         204179091
# 700      0.99823         0.00    722.385         232803438

# top4
# 20       0.82847         0.00    10090.858       16296798
# 30       0.87667         0.00    8315.531        21006736
# 50       0.92445         0.00    6159.475        28677521
# 100      0.96802         0.00    3790.627        47046557
# 200      0.98745         0.00    2206.419        81628623
# 300      0.99327         0.00    1587.839        114305752
# 400      0.99563         0.00    1240.112        145572555
# 500      0.99698         0.00    1008.379        175437572
# 600      0.99765         0.00    841.897         204822750


# top5
# 20       0.82751         0.00    10226.005       16322291
# 30       0.87681         0.00    8360.568        20933195
# 50       0.92446         0.00    6216.122        28746288
# 100      0.96763         0.00    3807.292        47240334
# 200      0.98762         0.00    2212.377        81146900
# 300      0.99321         0.00    1592.150        114168452
# 400      0.99562         0.00    1235.290        145777822
# 500      0.99692         0.00    1003.871        175442152
# 600      0.99770         0.00    841.836         204670392
# 700      0.99817         0.00    720.982         233294792

# top6
# 20       0.82776         0.00    10134.330       16348916
# 30       0.87630         0.00    8384.197        20839571
# 50       0.92464         0.00    6248.504        28804798
# 100      0.96771         0.00    3839.456        47208673
# 200      0.98753         0.00    2208.045        80938365
# 300      0.99318         0.00    1591.082        114522332
# 400      0.99560         0.00    1242.517        145261710
# 500      0.99692         0.00    1008.714        175380312
